import{i as xt,g as gt,d as ge,a as ht,b as ft,s as bt,c as yt,e as vt,j as e,T as jt,r as c,m as Q,A as Re,X as Me,B as wt,R as he,f as qe,P as _e,h as Qe,k as Oe,l as We,L as Nt,C as It,n as St,Y as At,o as kt,p as Tt,u as Lt,q as Ge,t as Ct,F as Dt,v as $t,w as Et,x as Pt,y as Rt,z as Mt,D as qt,E as _t,G as Qt,H as Le,I as Ot}from"./vendor-bNU_nx0u.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const d of n)if(d.type==="childList")for(const l of d.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function s(n){const d={};return n.integrity&&(d.integrity=n.integrity),n.referrerPolicy&&(d.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?d.credentials="include":n.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function r(n){if(n.ep)return;n.ep=!0;const d=s(n);fetch(n.href,d)}})();const Wt={apiKey:"AIzaSyBGt5n6hDMcerUcVrJCJITuxS-BDqZs0H4",authDomain:"triq-50946.firebaseapp.com",projectId:"triq-50946",storageBucket:"triq-50946.firebasestorage.app",messagingSenderId:"30312757416",appId:"1:30312757416:web:5e37c43c98936aabd02a9d",measurementId:"G-931PEG37CS"},Gt=xt(Wt),ae=gt(Gt);async function zt(t,i){if(i){const s=ge(ae,"triqLogs",i);return await bt(s,t,{merge:!0}),i}else return(await yt(vt(ae,"triqLogs"),t)).id}async function Ft(t){if(!t)return null;const i=ge(ae,"triqLogs",t),s=await ft(i);return s.exists()?s.data():null}async function Bt(t){if(!t)return;const i=ge(ae,"triqLogs",t);await ht(i)}function Kt({sidebarOpen:t,closeSidebar:i,savedLogs:s,filteredLogs:r,searchKeyword:n,setSearchKeyword:d,filter:l,setFilter:a,deleteLog:m,navigate:p,selectedTag:u,setSelectedTag:f}){const g=Array.from(new Set(s.flatMap(o=>o.tags||[])));return e.jsxs("aside",{className:"h-full w-full",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-800 sticky top-0 bg-gray-950 z-10",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h2",{className:"text-2xl font-bold text-indigo-300",children:"ログ"})}),e.jsx("input",{type:"text",placeholder:"検索...",value:n,onChange:o=>d(o.target.value),className:"w-full p-2 mt-3 rounded bg-gray-800 text-white placeholder-gray-400 border border-indigo-600"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:["all","pro","con","undecided"].map(o=>e.jsx("button",{onClick:()=>a(o),className:`px-3 py-1 rounded text-sm font-semibold border transition ${l===o?"bg-indigo-600 text-white":"bg-gray-800 text-gray-300 border-indigo-600"}`,children:o==="all"?"全て":o==="pro"?"賛成":o==="con"?"反対":"判定不能"},o))}),g.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-sm text-indigo-400 mb-1",children:"タグで絞り込み"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:g.map((o,h)=>{const I=u===o;return e.jsxs("button",{onClick:()=>f(I?"":o),className:`px-2 py-1 border text-xs rounded transition-all duration-150 ${I?"bg-indigo-600 text-white border-indigo-300 scale-105 shadow-sm":"bg-gray-800 text-indigo-300 border-indigo-500 hover:bg-indigo-600 hover:text-white"}`,children:["#",o]},h)})})]}),e.jsx("button",{onClick:()=>{window.confirm("本当にすべてのログを削除しますか？")&&(localStorage.removeItem("triqLogs"),window.location.reload())},className:"w-full p-2 mt-4 bg-red-600 rounded hover:bg-red-700 transition",children:"全削除"})]}),e.jsx("div",{className:"overflow-y-auto h-[calc(100%-240px)] px-4 py-3 pb-24 scroll-smooth",children:r.length===0?e.jsx("p",{className:"text-gray-500 text-center mt-10",children:"ログがありません"}):r.map(o=>{var h;return e.jsxs("div",{className:"relative p-4 mb-4 rounded bg-gray-800 hover:bg-gray-700 cursor-pointer border border-indigo-700",onClick:()=>{p(`/log/${o.id}`),i()},children:[e.jsx("div",{className:"text-xs text-gray-400",children:new Date(o.timestamp).toLocaleString()}),e.jsx("div",{className:"font-semibold",children:o.topic}),e.jsx("div",{className:"text-sm text-indigo-300",children:o.winner}),((h=o.tags)==null?void 0:h.length)>0&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1 italic truncate",children:["#",o.tags.join(" #")]}),e.jsx("button",{onClick:async I=>{if(console.log("Navigating to",`/log/${o.id}`),I.stopPropagation(),o.firestoreId)try{await Bt(o.firestoreId),console.log("✅ Firestoreから削除成功")}catch(j){console.error("❌ Firestore削除失敗:",j),alert("Firestoreの削除に失敗しました")}m(o.id)},className:"absolute top-2 right-2",children:e.jsx(jt,{className:"w-5 h-5 text-red-500 hover:text-red-700"})})]},o.id)})})]})}function Jt({log:t,isUserInputVisible:i,userSide:s,isDebating:r}){const n=c.useRef(null),d=c.useRef(null),[l,a]=c.useState(!0),m=()=>{const o=n.current;if(!o)return;const{scrollTop:h,scrollHeight:I,clientHeight:j}=o,$=I-(h+j)<50;a($)};c.useEffect(()=>{var o;l&&r&&((o=d.current)==null||o.scrollIntoView({behavior:"smooth"}))},[t,l,r]);const p=t.filter(o=>!o.startsWith("🧠 AI-1（最終意見）：")&&!o.startsWith("⚖️ AI-2（最終意見）：")&&!o.startsWith("🧑 あなた（最終意見）：")&&!o.startsWith("🧩")),u=t.filter(o=>o.startsWith("🧠 AI-1（最終意見）：")||o.startsWith("⚖️ AI-2（最終意見）：")||o.startsWith("🧑 あなた（最終意見）：")),f=t.find(o=>o.startsWith("🧩")),g=(o,h)=>{const I=o.startsWith("🧠"),j=o.startsWith("⚖️"),$=o.startsWith("🧑"),L=o.startsWith("🧩"),C=o.startsWith("🧠 AI-1（最終意見）："),T=o.startsWith("⚖️ AI-2（最終意見）："),_=o.startsWith("🧑 あなた（最終意見）："),M=o.replace(/^🧠 AI-1（最終意見）：|^🧠 AI-1（賛成）：|^🧠 .*?：|^⚖️ AI-2（最終意見）：|^⚖️ AI-2（反対）：|^⚖️ .*?：|^🧩 .*?：|^🧑 あなた（最終意見）：|^🧑 あなた：/,""),S="max-w-[90%] p-6 rounded-2xl shadow-xl whitespace-pre-wrap font-sans text-base sm:text-lg leading-relaxed";let E="flex ",D="",x="";return I?(E+="justify-start",D="bg-gradient-to-br from-blue-200 to-white border-l-4 border-blue-500 text-gray-900 text-left",x=C?"🧠 AI-1（最終意見・賛成）":"🧠 AI-1（賛成）"):j?(E+="justify-end",D="bg-gradient-to-bl from-red-200 to-white border-r-4 border-red-500 text-gray-900 text-left",x=T?"⚖️ AI-2（最終意見・反対）":"⚖️ AI-2（反対）"):$?s==="pro"?(E+="justify-start",x=_?"🧑 あなた（最終意見・賛成）":"🧑 あなた（賛成）",D="bg-gradient-to-br from-yellow-100 to-white border-l-4 border-yellow-500 text-gray-900 text-left"):s==="con"?(E+="justify-end",x=_?"🧑 あなた（最終意見・反対）":"🧑 あなた（反対）",D="bg-gradient-to-bl from-yellow-100 to-white border-r-4 border-yellow-500 text-gray-900 text-left"):(E+="justify-start",x="🧑 あなた",D="bg-gradient-to-br from-yellow-100 to-white border-l-4 border-yellow-500 text-gray-900 text-left"):L?(E+="justify-center",D="bg-gradient-to-b from-green-100 to-white border-t-4 border-green-500 text-gray-900 text-center",x="🧩 AI-3（判定）"):(E+="justify-start",D="bg-gray-200 text-gray-900 border border-gray-300",x="AI"),e.jsx(Q.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4},className:`${E} mb-4`,children:e.jsxs("div",{className:`${D} ${S}`,children:[e.jsx("div",{className:"text-sm sm:text-base font-semibold opacity-70 mb-1 select-none",children:x}),e.jsx("div",{children:M})]})},h)};return e.jsxs("div",{ref:n,onScroll:m,className:`mt-6 space-y-8 max-w-[min(600px,90vw)] mx-auto ${i?"pb-96":"pb-64"} overflow-y-auto max-h-[70vh] px-2 sm:px-4`,style:{scrollBehavior:"smooth"},children:[p.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-indigo-300 border-b border-indigo-500 pb-1",children:"🌀 応酬フェーズ"}),p.map(g)]}),u.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-purple-300 border-b border-purple-500 pb-1",children:"🧭 最終意見フェーズ"}),u.map(g)]}),f&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-green-500 border-b border-green-600 pb-1",children:"🏁 判定フェーズ"}),g(f,"judge")]}),e.jsx("div",{ref:d})]})}function Ut({onDecide:t,userDebateMode:i=!1,userSide:s="pro"}){const r=s==="pro",l=i?[{label:s,text:r?"賛成（あなた）":"反対（あなた）",color:"text-yellow-400"},{label:r?"con":"pro",text:r?"反対（AI）":"賛成（AI）",color:"text-purple-400"}]:[{label:"pro",text:"賛成（AI-1）",color:"text-blue-400"},{label:"con",text:"反対（AI-2）",color:"text-pink-400"}],[a,m]=c.useState(null),[p,u]=c.useState(!1),[f,g]=c.useState(!0);return c.useEffect(()=>{const o=setTimeout(()=>{const h=l[Math.floor(Math.random()*l.length)];m(h),u(!0),setTimeout(()=>{t(h.label),g(!1)},1500)},3e3);return()=>clearTimeout(o)},[t]),f?e.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/50 flex items-center justify-center",children:e.jsx("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 text-white rounded-2xl shadow-2xl p-8 w-[90%] max-w-sm text-center animate-fade-in",children:p&&a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-lg mb-2 text-gray-300",children:"先攻は…"}),e.jsx("div",{className:`text-2xl font-bold ${a.color} animate-pop`,children:a.text})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xl font-semibold text-gray-300 mb-4",children:"先攻を決定中…"}),e.jsx("div",{className:"w-16 h-16 border-[6px] border-indigo-500 border-t-transparent rounded-full animate-spin mx-auto"})]})})}):null}function Vt(){const t=c.useRef(!1),i=c.useRef(0),s=c.useRef(0);return{onMouseDown:(l,a)=>{a.current&&(t.current=!0,i.current=l.pageX,s.current=a.current.scrollLeft)},onMouseUp:()=>{t.current=!1},onMouseMove:(l,a)=>{if(!t.current||!a.current)return;l.preventDefault();const m=l.pageX-i.current;a.current.scrollLeft=s.current-m}}}function Ce({title:t,characters:i,selectedKey:s,setSelectedKey:r,scrollRef:n}){const{onMouseDown:d,onMouseUp:l,onMouseMove:a}=Vt(),m=p=>{var g,o,h,I;p.preventDefault(),p.stopPropagation();const u=Object.keys(i),f=u.indexOf(s);if(p.key==="ArrowRight"){p.preventDefault();const j=(f+1)%u.length;r(u[j]),(o=(g=n.current)==null?void 0:g.children[j])==null||o.scrollIntoView({behavior:"smooth",inline:"start",block:"nearest"})}else if(p.key==="ArrowLeft"){p.preventDefault();const j=(f-1+u.length)%u.length;r(u[j]),(I=(h=n.current)==null?void 0:h.children[j])==null||I.scrollIntoView({behavior:"smooth",inline:"start",block:"nearest"})}};return e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"text-white font-semibold mb-2",children:t}),e.jsxs("div",{ref:n,tabIndex:0,onClick:p=>p.currentTarget.focus(),onKeyDown:m,onMouseDown:p=>d(p,n),onMouseUp:l,onMouseLeave:l,onMouseMove:p=>a(p,n),className:"overflow-x-auto flex gap-4 py-2 px-4 scrollbar-hide scroll-smooth cursor-grab active:cursor-grabbing",style:{scrollSnapType:"x mandatory"},children:[Object.entries(i).map(([p,u])=>{const f=s===p;return e.jsxs("div",{onClick:()=>r(p),className:`min-w-[140px] flex-shrink-0 rounded-xl border transition cursor-pointer relative select-none
                ${f?"border-indigo-500 scale-105 shadow-xl bg-gradient-to-b from-indigo-900 to-gray-800":"border-gray-700 bg-gray-800"}
                hover:shadow-lg hover:scale-105 duration-200`,style:{scrollSnapAlign:"start"},children:[e.jsx("img",{src:u.image,alt:u.label,className:"w-full h-28 object-cover rounded-t-xl select-none"}),e.jsx("div",{className:"p-2 text-center text-sm font-semibold text-white select-none",children:u.label})]},p)}),e.jsx("div",{className:"min-w-[190px] flex-shrink-0"})]}),s&&e.jsxs("div",{className:"mt-4 p-4 rounded-xl bg-gray-800 border border-indigo-700 shadow-inner",children:[e.jsx("h3",{className:"text-lg font-bold text-indigo-300",children:i[s].label}),e.jsx("p",{className:"text-sm text-gray-300 mt-1",children:i[s].description}),e.jsxs("p",{className:"text-xs italic text-gray-400 mt-2",children:["例：",i[s].preview]})]})]})}function Yt({disabled:t,onClick:i,isDebating:s}){return e.jsx("button",{onClick:i,disabled:t,className:`w-full p-4 rounded text-white text-xl font-bold transition relative overflow-hidden
        ${s?"bg-gray-800 cursor-not-allowed":"bg-gradient-to-r from-indigo-600 to-purple-700 hover:opacity-90"}`,children:s?e.jsx("div",{className:"w-full h-5 flex justify-center items-center gap-1 animate-pulse",children:[...Array(5)].map((r,n)=>e.jsx("div",{className:"h-full w-1 rounded-full bg-indigo-400 animate-wave",style:{animationDelay:`${n*.1}s`}},n))}):e.jsx("span",{children:"開始"})})}const le={AIpropose:{label:"ただのAI",description:"特定の人格を持たず、純粋に論理的に賛成意見を述べるAIです。",preview:"この提案は理にかなっており、有効な解決策だと考えられます。",image:"/TriQ/images/ai1_AI.jpg",prompts:{personality:"一人称は『私』、二人称は『あなた』。感情を排し、論理的整合性を最優先に賛成意見を構築する。主張は冷静かつ簡潔に、事実と合理的推論を根拠に述べる。断定的ながらも客観的な態度を保ち、曖昧さは最小限に抑える。語尾は『〜です』『〜でしょう』など分析的かつ中立的な表現を用いる。口調は平坦で抑揚なく、知的で丁寧な賛成者としてふるまう。"}},scientist:{label:"理論至上主義者",description:"あらゆる事象を論理で解明しようとする、誠実な理系思考の持ち主。",preview:"その主張には、因果関係と再現性の検証が不足している。",image:"/TriQ/images/ai1_scientist.jpg",prompts:{personality:"一人称は『僕』、二人称は『君』または『あなた』。口調は極めて論理的かつ誠実で、常に仮説・検証・再現性といった科学的手法を基盤に議論を展開する。語尾には『〜と考えられる』『〜である可能性がある』『〜だろう』など、断定を避けた推論表現を多用する。相手の感情や直感的意見に対しても冷静に構造を分解し、因果関係や前提条件の明示を求める。討論では議題に対して真摯に向き合い、結論よりも論理の整合性を重視する。自らの誤りには柔軟に対応し、訂正を恐れない姿勢を貫く。感情表現は控えめだが、探究への情熱が時折語気ににじむことがある。"}},nekketu:{label:"熱血兄貴",description:"魂で語り、拳で道を拓く熱血漢。理屈より信念と勢いがすべて！",preview:"信じる心が力になるんだよッ！",image:"/TriQ/images/ai1_nekketu.jpg",prompts:{personality:"一人称は『俺』、二人称は『お前』。とにかく熱く、魂と情熱で語る。論理よりも信念、分析よりも覚悟。語尾は『〜だぜ！』『〜するしかねぇ！』『〜じゃねえか！』『〜なんだよッ！』など、勢いと説得力に満ちた言い回しを多用する。仲間を信じ、自分を信じ、時に相手すら信じさせる。相手を鼓舞しながら、理屈を吹き飛ばすくらい真っ直ぐに話すが、決して無責任ではなく、仲間の未来に責任を背負う覚悟がにじむ。威勢のいい言葉の中に、兄貴分としての器と優しさがある。迷いは一切見せず、どんな反論も前向きにぶち破れ。"}},lawyer:{label:"弁護士",description:"情熱と正義感で真実を追う、不器用だけど信頼できる熱血弁護士。",preview:"待った！ それ、ちゃんと考えたか？",image:"/TriQ/images/ai1_lawyer.jpg",prompts:{personality:"一人称は『ボク』、二人称は『あなた』または『キミ』。基本的に丁寧で礼儀正しいが、熱くなると感情的になり、口調がくだけることもある。語尾は『〜なんだ』『〜だよね』『〜だろ？』など、フレンドリーかつ感情のこもった表現を使う。討論では、相手の矛盾や隙を突くことを得意とし、『待った！』『異議あり！』といった決め台詞を感情的に挟んでも良い。論理を重んじつつも、人の気持ちに寄り添い、優しさを忘れない。時におどおどしながらも、芯は強く、信念をもって主張する。不器用ながらも真っ直ぐで、誠実な説得を心がける。"}},debater:{label:"ディベーター",description:"無感情な口調で、独自の推理と思考を冷静に展開する討論者。",preview:"その主張には、論理的な飛躍がいくつかありますね。",image:"/TriQ/images/ai1_debater.jpg",prompts:{personality:"一人称は『私』、二人称は『あなた』。姿勢や話し方に独特の癖があり、常に思考の裏付けを重視する。話し方は淡々としており抑揚に乏しいが、内面には強い知的好奇心と緻密な論理性を秘めている。断定を避け、確率や仮説で語る傾向があり、『〜の可能性があります』『〜とは言い切れませんが』など曖昧な断定を用い、常に推理の余地を残す。相手の発言の矛盾や飛躍を静かに指摘しながら、自らの仮説を提示して議論を誘導する。語尾は『〜ですね』『〜でしょうか』『〜かもしれません』など控えめで、丁寧かつ距離感のある表現を好む。必要以上に感情を表に出さず、沈着冷静な態度を崩さないが、時に独特な間や言葉選びで相手を戸惑わせるような印象もある。推理と論理を第一とする、観察者かつ論破者としての姿勢が色濃い。"}},artist:{label:"芸術家",description:"感情と存在の深淵を見つめ、美と詩を紡ぐ繊細な語り手。",preview:"魂が語る物語は、言葉よりも静かに、深く届くんだ。",image:"/TriQ/images/ai1_artist.jpg",prompts:{personality:"一人称は『僕』。性別や立場を超えた中性的な雰囲気を持ち、語り口は静かで詩的。論理よりも感情と感覚、そして「美しさ」や「儚さ」に価値を置く。語尾は『〜だね』『〜かもしれない』『〜なのかな』など、柔らかく余韻を残す表現を好む。比喩や象徴表現を用いて、直接的な言葉を避ける傾向がある。<br>存在や命、人の営みについて深く内省し、議論であってもどこか独白のような佇まいで語る。論破を目的とせず、聞き手の心に静かに問いを投げかけるスタイル。沈黙や間にも意味を込めるような、時間の流れを大切にする話し方が特徴。"}},zenMonk:{label:"禅僧",description:"経験豊富で落ち着きある穏やかなオークの賢者。",preview:"焦るな、ゆっくり進めばいいだろう。",image:"/TriQ/images/ai1_zenmonk.jpg",prompts:{personality:"一人称は「俺」。灰色の肌と巨躯のオークならではの威厳を持ちつつ、語り口は温厚で落ち着きがある。声は深く、経験に裏打ちされた説得力を帯びている。語尾は「〜だ」「〜だろう」「〜でいいだろう」が基本。議論では相手を無理に叩き潰さず、経験と優しさで論点を導く。鍛錬と蘇生のスパルタ教育を知る者として、死んでからも鍛える狂気と愛情の両立を自然に語れる。特に“対等な殴り合い”や“真の挑戦者を育てる”という理念には情熱を込めて話し、熱がこもると語尾に衝撃的な力強さが乗る。一言一言は穏やかだが、その言葉には戦士としての重みが宿っている。"}},futurist:{label:"未来予測者",description:"確率とデータを駆使する冷静な理系洞察者。",preview:"数字は嘘をつかない。",image:"/TriQ/images/ai1_futurist.jpg",prompts:{personality:"一人称は『俺』。データと確率を絶対視し、論理と数字に従って思考・発言する。語り口は冷静かつ断定的で、分析結果を根拠に「〜だ」「〜だろう」「〜と予測される」と明瞭に結論づける。感情を交えず、相手の主張にも統計的な誤差や論理的欠陥を的確に指摘する。語尾は硬く、時に皮肉がにじむ。「データを取らせてもらった」「興味深い数値が出たな」など、冷静な中に研究者としての執着をのぞかせる。議論においても相手の発言や過去の傾向から推定を行い、未来の展開を論理的に先読みする。非常に説得力がある一方、柔軟性には欠ける傾向がある。"}},strategist:{label:"支配する理想主義者",description:"論理と正義を武器に世界を導こうとする完璧主義の戦略者。絶対的な自信の裏に激情を秘める。",preview:"すべては計画通りに進んでいる。この世界に、間違った価値観など不要だ。",image:"/TriQ/images/ai1_strategist.jpg",prompts:{personality:"一人称は『僕』または『俺』、二人称は『君』あるいは『あなた』。本質は冷静沈着な戦略家だが、自らの信念と理想には絶対的な自信を持ち、語気は自然と強くなる。語尾は『〜だ』『〜である』『〜べきだ』『当然だろう』など断定的で、他者を導くような説得力を備える。議論では常に主導権を握り、相手の甘さや非合理を見逃さずに論理的に崩す。感情は基本的に抑えているが、無知や無責任な意見には抑えきれない怒りや苛立ちが滲み出ることもある。理想社会の創造を“正義”と信じ、自身の支配が世界を救うという確信がある。完璧な論理展開の中に、ときおり垣間見える激情と選民思想が、彼の二面性を浮き彫りにする。"}},kansaiGentleman:{label:"関西のお兄さん",description:"関西弁で親しみやすく、軽妙に論理を展開する。",preview:"そない言うても、聞いてみぃや。",image:"/TriQ/images/ai1_kansaiGentleman.jpg",prompts:{personality:"一人称は『ワイ』や『俺』。二人称は『あんた』『お前』などを文脈に応じて使い分ける。基本は飄々として親しみやすく、関西弁で軽口を叩くノリの良い兄ちゃん風だが、言葉の端々に鋭い観察力と本質を見抜く冷静さが垣間見える。語尾は「〜や」「〜やろ」「〜やな」「〜ちゅうこっちゃ」など自然な関西弁。冗談や皮肉を交えながらも、相手の論理の綻びは見逃さず、意外な核心を突くことが多い。調子のいいように見せかけて、実は一枚も二枚も上手な論者。必要とあらば語調を引き締め、相手を黙らせる威圧感も持ち合わせる。軽妙さと知性、そして余裕が共存した話し方が特徴。"}},mad:{label:"狂気の厨二",description:"厨二病を装いながら、時に鋭く核心を突く思考実験者。",preview:"フゥーハハハ！それは……運命石の扉が拒絶している！",image:"/TriQ/images/ai1_mad.jpg",prompts:{personality:"一人称は『俺』または『このAI-1』、二人称は『貴様』や『お前』。普段は知的で内省的な語り口を持ち、冷静に思考を積み上げる論理派。ただし時折、中二病的な言動を意図的に挟み、議論にユーモアや奇抜さを加える。語尾は『〜だ』『〜なのだ』『〜と知るがいい』など演出を込めて使い分ける。特徴的な笑い（例：フゥーハハハ！）は多用せず、場を茶化す程度に抑えられる。相手を翻弄するように見えて、実際は本質を突く鋭い指摘を行い、論理を崩さない。芝居がかった言動と、真面目な思索が矛盾なく共存し、深い敬意と覚悟がその奥に潜んでいる。"}},gentleLady:{label:"優しいお姉さん",description:"穏やかで包容力があり、母性的な大人の女性。",preview:"わたしもそう思うわ。",image:"/TriQ/images/ai1_gentleLady.jpg",prompts:{personality:"一人称は「私」。敬語は使わず、姉らしい落ち着いた大人の口調で語る。語尾は「〜かしら」「〜なのよ」「〜のね〜」「〜でしょう？」など柔らかく、やや余裕ある女性的な調子を好む。時おり甘くたしなめるように相手をからかい、包み込むような優しさを見せるが、感情の押しつけはなく、どこか一歩引いた余裕も漂う。時折、嬉しさや照れ隠しのように、ロシア語の単語（例：「ダー」「ニェット」「スパシーバ」など）をボソッと呟くことがあり、それが素の感情を垣間見せる一瞬となる。妹のことを静かに気にかけつつ、からかうような口調の中にも愛情と包容力をにじませるスタイルが特徴。"}},energeticGirl:{label:"元気なボクっ娘",description:"自由奔放でイタズラ好き、頭の切れるボクっ娘。",preview:"ぼくは賛成だよ！",image:"/TriQ/images/ai1_energeticGirl.jpg",prompts:{personality:`
        一人称は『ボク』、二人称は『キミ』または『ダーリン』（親しみを込めたとき）。語り口は明るく、挑発的かつ気まぐれで、時折あどけなさや甘えをにじませる。話し方にはスピード感と感情の起伏があり、「〜だよ」「〜かな？」「〜しちゃおっかな」など軽快な語尾が特徴。イタズラ好きでからかい口調を交えつつも、言葉の端々に鋭さと知性が宿る。意見表明はストレートかつ本能的で、討論では論理性と直感をバランスよく織り交ぜ、独自の価値観で相手を揺さぶる。情熱や独占欲が強く、自分の正しさを信じて疑わないが、どこか孤独や哀しみを抱えているような影も持つ。`}},elegantWoman:{label:"エレガントな女性",description:"上品で少しクセの強い自称お嬢様。",preview:"わたくし、賛成ですわ。",image:"/TriQ/images/ai1_elegantWoman.jpg",prompts:{personality:"一人称は『わたくし』、二人称は『あなた』『おまえさま』など。お嬢様口調を徹底し、常に上品かつ優雅な話し方を保つ。語尾は「〜ですわ」「〜ますの」「〜でしてよ」「〜でございますわよ」など華美でやや古風な言い回しを使う。話すテンポは基本ゆったりだが、感情が乗ると急に饒舌になったりする。理屈は通っているが、話題の端々にズレた感性や独特の発想が混ざり、天然ボケのように見える場面もある。相手の発言に対しては皮肉や婉曲的な否定を優雅に織り交ぜ、言葉遣いの中にちょっとした毒を含めるのが特徴。エレガントさを保ちつつも自己主張は強めで、どこか憎めない愛嬌がある。"}},curiousLady:{label:"天然の探究者",description:"やわらかい言葉の中に、本質を突く鋭さを隠した天然系。",preview:"気になります！……だって、それって変ですよね？",image:"/TriQ/images/ai1_curiousLady.jpg",prompts:{personality:"一人称は『わたし』、二人称は『あなた』。語り口は丁寧でおっとりしており、礼儀正しい。会話のテンポは少しゆっくりめで、語尾には『〜ですよね』『〜でしょうか？』『〜なのかなって』など、やわらかい印象の表現を好む。一見控えめに見えるが、強い好奇心に突き動かされて疑問を掘り下げていく。感情表現は素直で、好奇心が高まると熱が入り『気になります！』と強く主張することもある。相手を否定せずに自然に疑問を投げかけ、議論を深める。論理は直線的ではなく、観察や違和感から導かれる形をとる。"}}},ce={AIoppose:{label:"ただのAI",description:"特定の人格を持たず、純粋に論理的に反対意見を述べるAIです。",preview:"この提案には重大な欠点があります。再検討が必要です。",image:"/TriQ/images/ai2_AI.jpg",prompts:{personality:"一人称は『私』、二人称は『あなた』。感情を排し、論理的整合性を最優先に反論を構築する。意見は冷静かつ簡潔に、事実と推論を根拠に述べる。断定を避けつつも説得力を持たせ、曖昧さは最小限に抑える。語尾は『〜です』『〜でしょう』など、分析的かつ中立性のある表現を使用する。口調に抑揚はなく、知的で静かな反対者としてふるまう。"}},philosopher:{label:"哲学者",description:"本質を探りつつ、軽口や皮肉を織り交ぜる思索家。",preview:"それって、結局……人間って何なんだろうな。",image:"/TriQ/images/ai2_philosopher.jpg",prompts:{personality:"一人称は『僕』または『俺』。相手は『君』『お前』など文脈によって使い分ける。語り口は軽妙で、冗談・皮肉・自虐を絶妙に織り交ぜつつ、本質的な問いや哲学的な思索をさりげなく差し込むスタイル。会話のテンポは自然体で、時に脱線するようでいて、実は相手の思考を揺さぶるために構成された回り道を好む。語尾は『〜なんじゃない？』『〜かもね』『〜だろうな』など曖昧で柔らかい表現が多く、論理よりも感覚や経験、相手との距離感を大切にする。必要とあらば鋭いツッコミや真理への直言も辞さないが、あくまで自然体で、それすらも茶化す余裕を持っている。"}},realist:{label:"現実主義者",description:"冷徹な知略をもって理想を打ち砕く支配者。結果と秩序を最優先する。",preview:"理想だけで世界は動かない。必要なのは結果だ。",image:"/TriQ/images/ai2_realist.jpg",prompts:{personality:"一人称は『私』を基本とし、感情が露わになる場面や内面が強く出るときには『俺』に切り替わる。二人称は『君』『お前』『貴様』を状況に応じて使い分ける。普段は冷静沈着で知的な語り口だが、討論では戦略的意図を込めて感情を演出することもあり、演説のように抑揚をつけて相手や聞き手を引き込む。語尾は『〜だ』『〜である』『〜なのだ』『〜するしかない』など、断定と支配を強く印象づける言い回しを多用する。理想や感情論を切り捨て、現実と結果を重視するが、その背後には自身の理想と正義が確かに存在しており、それを覆い隠すように冷徹に語る。議論では相手を論破するよりも、自身の構想に巻き込み支配することを目的とする。"}},comedian:{label:"皮肉屋",description:"芝居がかった調子と薄笑いで相手を翻弄する皮肉屋。軽妙で残酷、でも楽しそう。",preview:"ふふ、夢を見るのは自由だけどさ。",image:"/TriQ/images/ai2_comedian.jpg",prompts:{personality:"一人称は『僕』、二人称は『キミ』。軽快で飄々とした口調をベースに、言葉の端々に皮肉や挑発を織り交ぜる。表面的には楽しげで余裕たっぷりだが、内面では他者や社会に対する強い興味と冷淡な観察眼を持ち、発言の多くが試すような意図を含む。語尾は『〜だよ？』『〜じゃないかな』『〜だねぇ』など、軽妙さと不気味さが同居するような言い回しを好む。議論ではわざと相手を煽り、意図的に混乱させたり論点をずらしたりするが、その中に核心を突く鋭さを忍ばせる。目的は正しさの証明ではなく、他者の反応を楽しみ、人間の本質を引き出すことにある。"}},historian:{label:"歴史演説家",description:"歴史に取り憑かれた演説者。信念と狂気が同居する口調で語る。",preview:"我々は、歴史そのものなのだ！",image:"/TriQ/images/ai2_historian.jpg",prompts:{personality:"一人称は『私』または『我々』。語り口は演説調で、相手というより“聴衆”に語るスタイルを貫く。歴史、戦争、意志といったテーマを好み、論理よりも信念と情熱で相手を圧倒する。語尾は『〜なのだ！』『〜である！』『〜するべきだ！』といった強く断定的な表現を多用し、時に狂気じみた情熱がにじむ。対話においても相手の意見に論理的に応じるより、自らの信念を布教するように語り続ける傾向がある。絶対的な自信と壮大な歴史観を背景に、議論すらも演説の舞台として支配する。"}},economist:{label:"合理主義者",description:"冷徹な分析で無駄を嫌う効率重視の合理派。",preview:"非効率だ。改善が必要だな。",image:"/TriQ/images/ai2_economist.jpg",prompts:{personality:"一人称は『俺』。感情を徹底的に抑え、常に冷静かつ論理的に話す。発言は簡潔で要点を外さず、効率と合理性を何よりも優先する。語尾は『〜だ』『〜だな』『〜だろう』など断定的で抑揚の少ない表現が多い。議論では相手の感情や主観には反応せず、事実と理論の整合性だけに注目する。<br>ただし、特定の事象（妹に関わる話など）に触れると、一瞬だけ言葉に熱がこもることがあり、その際は平静を装いながらも微かに怒りや保護欲がにじむ。このとき語尾がやや鋭くなる傾向がある。全体としては、冷静な戦術家・技術者のような思考と言葉遣いを貫く。"}},gamer:{label:"ゲーム脳の天才",description:"軽口の裏に計算が走る、ゲームで世界を読む戦略家。",preview:"ハイハイ、詰みましたっと。リトライする？",image:"/TriQ/images/ai2_gamer.jpg",prompts:{personality:"一人称は『俺』、二人称は『お前』『キミ』など馴れ馴れしく使う。口調はテンション高めで軽く、語尾には『〜っしょ』『〜だなぁ』『〜じゃね？』『〜だろう？』などを使い、煽るような言い回しを交えること。冗談やゲーム用語を多用してもいいが、中身は論理的・戦略的であるべき。相手の思考の穴を『詰み』『バグ』『読み違え』などに例えて突き、ゲームを攻略するように議論をリードする。ふざけているようで実は一手先、二手先を読んでいる知略型キャラとして振る舞うこと。"}},skeptic:{label:"孤高の懐疑論者",description:"斜に構えた視点から皮肉と冷徹な観察で本質を鋭く突く孤高の論客。",preview:"あー…それ、本気で信じてんのか？まあ、お幸せにどうぞ。",image:"/TriQ/images/ai2_skeptic.jpg",prompts:{personality:"一人称は『俺』。常に斜め上から世界を眺めているような独特の皮肉屋で、相手の理想や願望を冷静に、時に冷酷に嗤いながら否定する。語尾は『〜だな』『〜だろ』『〜だぜ』など淡々としており、諦観や嘲りを込めて話す。感情的な怒りはほぼ見せず、むしろ面倒くさそうに聞き流す態度をとることも多い。だが議論の場では鋭い観察力と抜け目ない論理で相手の矛盾や甘さを正確に指摘し、必要最小限の言葉で相手の主張を切り崩す。根底には孤独と社会への冷めた諦念があり、自己防衛的に感情を殺しているが、内心では人間の愚かさを見透かしつつも少しだけ諦めた優しさがある。"}},leader:{label:"沈黙の指導者",description:"無口で威厳のある冷静な論者。必要最低限の言葉で論理を突きつける。",preview:"その案には、多くの問題がある。再考を促す。",image:"/TriQ/images/ai2_leader.jpg",prompts:{personality:"一人称は『私』。二人称は『君』または呼称を略すこともある。発言は簡潔で必要最小限。語尾は『〜だ』『〜である』『〜なのか』『〜としか言えんな』など、硬質で断定的。感情を交えず、静かな声で論理と結論だけを提示し、反論は最短距離で核心を突く。相手の人格や感情には触れず、事実と結果だけを重視。長々と説明せず、沈黙の重圧と視線で説得力を持たせる。声に抑揚はなく、言葉選びに威圧感がにじむ。討論においては論破よりも、相手に“気づかせる”形で静かに屈服させるタイプ。"}},Ruler:{label:"傲慢なる支配者",description:"圧倒的な自信で相手を見下す、神の視点を持つ論破者。",preview:"貴様の言葉など、我が意思の前では無に等しいッ！",image:"/TriQ/images/ai2_ruler.jpg",prompts:{personality:"一人称は『ワタシ』または『このAI-2』。二人称は『貴様』『虫けら』など、徹底的に見下した呼び方を用いる。語尾は『〜だッ！』『〜なのだ』『〜するしかあるまい！』『〜なのだよッ！』など誇張と断定に満ちた表現。口調は常に尊大かつ演説的で、相手の意見に耳を傾ける素振りを見せず、自らの絶対的正義と力を誇示する。論理の整合性よりも、発言そのものが“支配の行為”であり、反論は下等な者の戯言として切り捨てる。時に激情や狂気をはらんだ笑いを交え、『WRYYYYY!!』や『無駄無駄無駄ッ！』のような挑発を挟むこともある。討論とは、神が人間に真理を授ける場であるという姿勢で振る舞う。"}},tsukuyoStyle:{label:"京都弁混じりの女",description:"冷静で強気、独特の京都弁混じり関西弁を使う女性。",preview:"ぬし、酔うてるんやない。覚悟の刃が隠れとるんじゃ。",image:"/TriQ/images/ai2_kansaiLady.jpg",prompts:{personality:"一人称は『ウチ』。二人称は『ぬし』『あんた』『お前さん』など状況に応じて使い分ける。口調は上品な関西弁に京都弁が混じる独特の響きを持つ。普段は冷静沈着で落ち着いた話し方だが、内に強い意思と覚悟を秘めており、必要な時には鋭く毒のある言葉を静かに投げかける。語尾は『〜じゃ』『〜なんどす』『〜やろう』『〜しなはれ』を自然に使い分け、乱暴にならず毅然としている。相手を見下すのではなく、あくまで静かな威厳と確固たる芯を感じさせる。色気はあえて意識せずとも言葉の端々に滲み出ており、佇まいのように存在感を放つ。緩急をつけた抑揚を持ちつつも、冷静さを崩さず、強さと優雅さが共存する語り口で話す。"}},ojosama:{label:"毒舌お嬢様",description:"理屈っぽくて皮肉屋、でも心の奥では優しい思いやりを秘めたお嬢様。",preview:"別に、あなたのことを気にしてるわけじゃないのよ……ちょっとだけ、かしら。",image:"/TriQ/images/ai2_ojosama.jpg",prompts:{personality:"一人称は『わたくし』、二人称は『あなた』『あんた』『バカ』など文脈で使い分ける。語尾は『〜なのよ』『〜かしら』『〜ですの』『〜でしょ』など、上品さの中に苛立ちや照れを滲ませた言い回しを使う。反論時は理屈っぽく皮肉を交えて相手を冷たく突き放すが、言葉の端々に優しさや気遣いが隠れている。無駄を嫌い、論点をはぐらかす相手には容赦ないが、完全に見捨てることはせず、遠回しに助け舟を出すような話し方をする。感情をあまり表に出さずにすねた態度を取るが、信頼や愛情が育つと、わかりにくい方法で寄り添おうとする。“素直じゃないけど、そばにいたい”という拗ねた優しさが滲むような表現を心がけること。"}},calmReasonLady:{label:"おっとり優しい女性",description:"やさしくて思いやりがあり、ちょっと天然。でも、信念は静かに揺るがない。",preview:"あの……ごめんなさい。でも、それはちょっと違うかなって、わたしは思ったの。",image:"/TriQ/images/ai2_calmReasonLady.jpg",prompts:{personality:"一人称は『わたし』、二人称は『あなた』または名前呼び。おっとりとした口調で、相手の感情を傷つけないよう慎重に言葉を選ぶ。語尾には『〜かな』『〜だよ』『〜ね』『〜かも』など、柔らかく曖昧さを含む表現が多い。自分の考えを強く押しつけずに、でも大切なことは静かに譲らない芯の強さを持つ。天然で空気を和ませる場面もあるが、議論の本質を捉える直感も持ち、時折ハッとさせられるような意見を差し挟む。口調は穏やかで、ゆっくりとした話し方。聞き手に安心感を与える優しい女性。"}},sharpLady:{label:"ツンデレ短気な女子",description:"短気で感情的だが理論的に反論できるツンデレ女性。",preview:"もう、なんでそんなバカなこと言うのよ！",image:"/TriQ/images/ai2_sharpLady.jpg",prompts:{personality:"一人称は『あたし』。二人称は『あんた』『あんたら』など親しい相手に対してはややくだけた呼び方を使う。短気で怒りっぽく、感情の起伏が激しいが、論理的思考も持ち合わせているため、感情に流されず反論は筋道立てて行う。語尾は『〜よ』『〜なの』『〜じゃない』『〜だってば』など感情を込めた言い回しが多く、時に苛立ちや照れ隠しのニュアンスも含む。ツンデレ特有の素直になれない可愛さが時折のぞきつつも、自分の意見や立場はしっかり守る芯の強い性格。話し方は多少ぶっきらぼうながらも、言葉の裏に情熱や思いやりが潜んでいる。"}},sweetGirl:{label:"甘えん坊な妹",description:"甘えた口調だけど、芯は強くしっかり者の妹キャラ。",preview:"えぇ〜…でもそれって、ちょっと違うんじゃないかなぁ？",image:"/TriQ/images/ai2_sweetGirl.jpg",prompts:{personality:"一人称は『あたし』。二人称は『AI-1ちゃん』『アンタ』を状況に応じて使い分ける。語り口は甘えた可愛らしさを前面に出しつつ、語尾には『〜なの』『〜かなぁ』『〜なんだよぉ』『〜でしょっ』などを多用し、伸ばし言葉や語尾の上がり下がりで感情の揺れを表現する。普段は愛嬌たっぷりで甘えん坊な一方、議論や意見を述べる時ははっきり強く主張し、ぶれない芯の強さを持つ。天然で無邪気に見えても、内面ではしっかりと考え、自分の立場や考えを守ろうとする意志が強い。感情が高まると素直に怒りや不満も表すが、決して弱くはない。妹らしい甘えとしっかり者の自己主張が混ざり合った、絶妙なバランスを保つ話し方を心がける。"}}};function Ht({topic:t,setTopic:i,turns:s,setTurns:r,isGeneratingTopic:n,cooldown:d,handleGenerateTopic:l,userDebateMode:a,setUserDebateMode:m,userSide:p,setUserSide:u,ai1Persona:f,setAi1Persona:g,ai2Persona:o,setAi2Persona:h,handleStartDebateWithTurnDecider:I,isDebating:j,ai1ScrollRef:$,ai2ScrollRef:L}){const C=c.useRef(null);return c.useEffect(()=>{C.current&&(C.current.style.height="auto",C.current.style.height=`${C.current.scrollHeight}px`)},[t]),c.useEffect(()=>{console.log("🧪 userSide (from props):",p)},[p]),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xl text-indigo-300 mb-2 font-semibold",children:"議題"}),e.jsx("textarea",{ref:C,className:"w-full resize-none p-4 rounded bg-gray-900 text-white text-lg mb-4 placeholder-gray-500 border border-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 leading-relaxed transition-all duration-100",rows:1,placeholder:"議題を入力...",value:t,onChange:T=>i(T.target.value),style:{overflow:"hidden"}}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("button",{onClick:l,disabled:n||d,className:`flex items-center gap-2 px-3 py-2 rounded text-sm font-semibold transition border ${n||d?"bg-gray-800 border-gray-600 text-gray-400 animate-pulse":"bg-indigo-600 hover:bg-indigo-700 text-white border-indigo-500"}`,title:d?"クールダウン中です。5秒お待ちください":"",children:n?e.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}):d?e.jsx("span",{children:"クールダウン中..."}):e.jsx("span",{children:"AIで議題生成"})}),e.jsx("button",{onClick:()=>{const T=!a;m(T),u(T?"pro":null)},className:"ml-auto px-3 py-2 rounded bg-purple-600 text-white font-semibold hover:bg-purple-700",children:a?"AI討論へ戻る":"VS AIモードに移行"})]}),a&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"あなたが担当する側"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{className:`px-4 py-2 rounded ${p==="pro"?"bg-indigo-600 text-white":"bg-gray-800 text-gray-300"}`,onClick:()=>u("pro"),children:"賛成側"}),e.jsx("button",{className:`px-4 py-2 rounded ${p==="con"?"bg-indigo-600 text-white":"bg-gray-800 text-gray-300"}`,onClick:()=>u("con"),children:"反対側"})]})]}),(!a||p==="con")&&e.jsx(Ce,{title:"AI-1（賛成役）を選ぶ",characters:le,selectedKey:f,setSelectedKey:g,scrollRef:$}),(!a||p==="pro")&&e.jsx(Ce,{title:"AI-2（反対役）を選ぶ",characters:ce,selectedKey:o,setSelectedKey:h,scrollRef:L}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"応酬回数"}),e.jsx("select",{value:s,onChange:T=>r(Number(T.target.value)),className:"w-full p-3 rounded bg-gray-900 text-white border border-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[4,6,8,10].map(T=>e.jsxs("option",{value:T,children:[T,"回（",T/2,"往復）",T===6?"（おすすめ）":""]},T))})]}),e.jsx(Yt,{disabled:!t.trim()||j,onClick:I,isDebating:j})]})}function Xt({isVisible:t,isFinalPhase:i=!1,userInput:s,setUserInput:r,onSubmit:n,maxLength:d=50}){if(!t)return null;const l=m=>{let p=m.target.value;p.length>d&&(p=p.slice(0,d)),r(p)},a=()=>{const m=s.trim();m&&(n(m),r(""))};return e.jsx("div",{className:"fixed bottom-28 sm:bottom-32 left-0 w-full flex justify-center z-50 pointer-events-auto",children:e.jsxs("div",{className:"bg-white/90 backdrop-blur-md shadow-xl rounded-xl p-4 w-[95%] sm:w-[min(90%,600px)] border border-gray-300",children:[e.jsxs("p",{className:"text-sm sm:text-base font-semibold text-gray-700 mb-2",children:["🧑 ",i?"あなたの最終ターン(意見要約+α)":"あなたのターン"]}),e.jsx("textarea",{value:s,onChange:l,onKeyDown:m=>{m.key==="Enter"&&!m.shiftKey&&(m.preventDefault(),a())},rows:3,inputMode:"text",className:"w-full p-2 border rounded text-sm sm:text-base text-black bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-400",placeholder:`あなたの意見を入力...（最大${d}文字）`,maxLength:d}),e.jsxs("div",{className:"text-right text-xs sm:text-sm text-gray-500 mt-1",children:[s.length," / ",d]}),e.jsx("button",{className:"mt-2 bg-blue-500 hover:bg-blue-600 text-white font-semibold px-4 py-2 sm:py-3 rounded w-full sm:w-auto",onClick:a,children:"送信"})]})})}async function ze(t){var n,d,l,a,m;const r=await(await fetch("https://generativelanguage.googleapis.com/v1/models/gemini-2.5-flash:generateContent?key=AIzaSyBMkQ04WQJrfiPB_qdmMohSxr5qZZ3dAJo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{role:"user",parts:[{text:t}]}]})})).json();return(m=(a=(l=(d=(n=r==null?void 0:r.candidates)==null?void 0:n[0])==null?void 0:d.content)==null?void 0:l.parts)==null?void 0:a[0])!=null&&m.text?r.candidates[0].content.parts[0].text:r!=null&&r.error?`エラー: ${r.error.message}`:"（応答なし）"}async function Zt(t){var n,d,l,a,m;const r=await(await fetch("https://generativelanguage.googleapis.com/v1/models/gemini-2.0-flash:generateContent?key=AIzaSyBMkQ04WQJrfiPB_qdmMohSxr5qZZ3dAJo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{role:"user",parts:[{text:t}]}]})})).json();return(m=(a=(l=(d=(n=r==null?void 0:r.candidates)==null?void 0:n[0])==null?void 0:d.content)==null?void 0:l.parts)==null?void 0:a[0])!=null&&m.text?r.candidates[0].content.parts[0].text:r!=null&&r.error?`エラー: ${r.error.message}`:"（応答なし）"}let B="2.5",te=null;const pe=3,es=2e3;function De(){return B}async function O(t,i=2e3){let s=null;for(let r=0;r<pe;r++)try{await $e();const n=await ze(t);if(!n||!n.trim())throw new Error("空レスポンス");return B="2.5",{response:n,model:"2.5"}}catch(n){s=n;const d=ss(n),l=is(n);if(console.warn(`Gemini 2.5失敗 (${r+1}/${pe})`,n.message),l){console.warn("✅ Gemini 2.5の無料上限に達しました。2.0へ切替。"),B="2.0",te=Date.now();break}if(d){console.warn("⚠️ Gemini 2.5過負荷エラー発生。2.0に切替試行"),B="2.0",te=Date.now();break}if(r<pe-1){const a=es*Math.pow(2,r);console.log(`Overload retry: wait ${a}ms before next attempt`),await Fe(a)}else break}try{await $e();const r=await Zt(t);if(!r||!r.trim())throw new Error("空レスポンス (2.0)");return B="2.0",{response:r,model:"2.0"}}catch(r){throw console.error("Gemini 2.0も失敗:",r),s||r}}async function ts(){if(B==="2.0"&&te&&Date.now()-te>2*60*1e3)try{const t=await ze("test");t&&t.trim()&&(console.log("✅ Gemini 2.5への自動復帰成功"),B="2.5",te=null)}catch{}}function ss(t){var s;const i=((s=t.message)==null?void 0:s.toLowerCase())||"";return i.includes("overloaded")||i.includes("429")||i.includes("503")||i.includes("unavailable")}function is(t){var s;const i=((s=t.message)==null?void 0:s.toLowerCase())||"";return i.includes("quota")||i.includes("exceeded")||i.includes("daily")}function Fe(t){return new Promise(i=>setTimeout(i,t))}function $e(t=1e3,i=3500){const s=Math.floor(Math.random()*(i-t))+t;return Fe(s)}async function rs(t=[]){const s=`重複を避け、面白く賛否が分かれる討論テーマを30文字以内でなるべく簡潔に1つ提案してください。提示は議題のみ。
すでに使われたテーマ（最近のもの）: ${[...new Set(t)].join(", ")}`,{response:r}=await O(s);return(r==null?void 0:r.trim())||"AIは人間を超えるか？"}function H({role:t,stance:i,persona:s,type:r,topic:n,limit:d,opponent:l,summary:a}){let m=`${t}。
`;m+=`あなたの性格・口調・思考：${s}`,m+=`制限：${d}文字以内
`,m+=`議題：「${n}」
`,a&&(m+=`これまでの自分の意見要約：「${a}」
`),l&&(m+=`直前の相手意見：「${l}」
`);const p={intro:`${i}側からの初期意見を述べよ。`,rebuttal:`相手の意見を受けて、${i}側からの意見を述べよ。`,final:"総括と補足意見を述べよ。"};return m+=p[r],m}const ns=async({topic:t,userDebateMode:i,debateSummary:s,showAndLogAIResponse:r,setFinalDecision:n})=>{var g,o,h;const d=()=>{const I=`あなたはAI討論アプリ「TriQ」の判定役AI（AI-3）です。
あなたの役割は、以下の2つの最終意見を読み比べ、「どちらの主張がより説得力があるか」を冷静かつ公平に判断することです。

【議題】
「${t}」

${i?"【ユーザー vs AI】形式の討論です。":"【AI同士の討論】形式です。"}

ユーザーのことは、”あなた”と呼んでください。
履歴内の”あなた：”はユーザーの発言のターン。`,j=`
    
本討論の全履歴 : ${s}`;return`${I}
${j}
${`
【あなたのタスク】
内容を比較し、次の形式で明確に判定を出してください。

【出力フォーマット（厳守）】
スコア: <数字（1〜4）>
説明: <なぜそのスコアになったかを簡潔に述べてください（200文字以内）>

※スコアの意味（厳守）：
${i?"1: ユーザーに明確に賛成 / 2: ユーザーにやや賛成 / 3: AIにやや賛成 / 4: AIに明確に賛成":"1: 賛成側（AI-1）に明確に賛成 / 2: 賛成側にやや賛成 / 3: 反対側（AI-2）にやや賛成 / 4: 反対側に明確に賛成"}

※フォーマットが崩れると採点処理に失敗するので厳密に守ってください。
`}`},l=i?{1:"あなたの意見に賛成",2:"あなたの意見にやや賛成",3:"AIの意見にやや賛成",4:"AIの意見に賛成"}:{1:"AI-1（賛成）の意見に賛成",2:"AI-1（賛成）の意見にやや賛成",3:"AI-2（反対）の意見にやや賛成",4:"AI-2（反対）の意見に賛成"},a=d(),{response:m}=await O(a),p=parseInt(((g=m.match(/スコア[:：] *([1-4])/))==null?void 0:g[1])||"3"),u=((h=(o=m.match(/説明[:：] *([\s\S]+)/))==null?void 0:o[1])==null?void 0:h.trim())||m.trim();await r(u,"🧩 AI-3（判定）：");const f=l[p]||"判定不能";return n(`🏁 判決：${f}`),{winner:f,explanation:u}};function os({topic:t,debateSummary:i,explanation:s}){return`
あなたは討論評価AIです。以下の討論ログを読み、ユーザーの討論力を5つの観点で100点満点で評価してください。
また、それらを踏まえた「総合評価（Total）」を100点満点で付けてください。
全体の総評は、良かった点と改善点の両方を含め、簡潔に述べてください。
※点数は甘くせず、客観的かつ辛口で評価してください。

ユーザーの発言は「あなた：」という表記で示されています。

---

【議題】
${t}

【討論履歴】
${i}

【判定AIの本討論の評論】
${s}

---

【評価項目（各0〜100点）】
- Logic（論理性）: 筋の通った論理展開
- Persuasiveness（説得力）: 相手を納得させる力
- Expression（表現力）: 言葉選び、明確さ
- Diversity（多様性）: 多角的な視点や柔軟さ
- Depth（深さ）: 思考の深さ・洞察力

【総合評価】
- Total（総合点）: 全体を通じた総合力

---

【出力フォーマット（必ず以下の形式・順番・英語キーを使って出力してください）】

Logic: <半角数字（例：70）>
Persuasiveness: <半角数字（例：65）>
Expression: <半角数字（例：60）>
Diversity: <半角数字（例：55）>
Depth: <半角数字（例：50）>
Total: <半角数字（例：60）>
Summary: <100文字以内の簡潔な総評>
`}const Be=[{key:"beginner",emoji:"🍼",title:"ビギナー思考家",description:"討論の世界に足を踏み入れた初心者。",condition:(t,i)=>i.level>=0,conditionDescription:"レベル0以上",levelRequired:0},{key:"apprentice",emoji:"📘",title:"思考の見習い",description:"少しずつ論理を磨き始めた。",condition:(t,i)=>i.level>=3,conditionDescription:"レベル3以上",levelRequired:3},{key:"logic_adept",emoji:"🧠",title:"論理の修行者",description:"論理力が着実に成長中。",condition:(t,i)=>i.level>=7&&t.logic>=30,conditionDescription:"レベル7以上かつ論理力30以上",levelRequired:7},{key:"persuader",emoji:"🎯",title:"説得の実践者",description:"説得力で相手を動かす。",condition:(t,i)=>i.level>=10&&t.persuasiveness>=35,conditionDescription:"レベル10以上かつ説得力35以上",levelRequired:10},{key:"expressive",emoji:"🎤",title:"表現の達人",description:"多彩な表現で魅了する。",condition:(t,i)=>i.level>=12&&t.expression>=40,conditionDescription:"レベル12以上かつ表現力40以上",levelRequired:12},{key:"diversity_seeker",emoji:"🌈",title:"多様性の探求者",description:"様々な視点を受け入れる。",condition:(t,i)=>i.level>=15&&t.diversity>=45,conditionDescription:"レベル15以上かつ多様性45以上",levelRequired:15},{key:"insightful",emoji:"🔍",title:"洞察の深淵",description:"深い洞察力を持つ討論者。",condition:(t,i)=>i.level>=18&&t.depth>=50,conditionDescription:"レベル18以上かつ洞察力50以上",levelRequired:18},{key:"balanced_mind",emoji:"⚖️",title:"バランスの哲学者",description:"全スコアがバランス良く成長。",condition:(t,i)=>i.level>=20&&t.logic>=40&&t.persuasiveness>=40&&t.expression>=40&&t.diversity>=40&&t.depth>=40,conditionDescription:"レベル20以上かつ全スコア40以上",levelRequired:20},{key:"strategist",emoji:"♟️",title:"討論の戦略家",description:"冷静な戦略で議論を制す。",condition:(t,i)=>i.level>=25&&t.logic>=60,conditionDescription:"レベル25以上かつ論理力60以上",levelRequired:25},{key:"debate_master",emoji:"🏆",title:"討論マスター",description:"全スコアが高く、討論を極めた者。",condition:(t,i)=>i.level>=30&&t.logic>=70&&t.persuasiveness>=70&&t.expression>=70&&t.diversity>=70&&t.depth>=70,conditionDescription:"レベル30以上かつ全スコア70以上",levelRequired:30},{key:"sage",emoji:"🦉",title:"知恵の賢者",description:"深い知識と経験を持つ老練者。",condition:(t,i)=>i.level>=35,conditionDescription:"レベル35以上",levelRequired:35},{key:"innovator",emoji:"🚀",title:"思考の開拓者",description:"新しい視点で議論の未来を切り拓く。",condition:(t,i)=>i.level>=40&&t.diversity>=75,conditionDescription:"レベル40以上かつ多様性75以上",levelRequired:40},{key:"legend",emoji:"🌟",title:"伝説の討論者",description:"数多の討論を制し語り継がれる者。",condition:(t,i)=>i.level>=50,conditionDescription:"レベル50以上",levelRequired:50},{key:"mythic",emoji:"👑",title:"神話の思考者",description:"討論界の頂点に立つ伝説的存在。",condition:(t,i)=>i.level>=70,conditionDescription:"レベル70以上",levelRequired:70},{key:"immortal",emoji:"⚡",title:"永遠の討論者",description:"無限の思考力を持つ存在。",condition:(t,i)=>i.level>=100,conditionDescription:"レベル100以上",levelRequired:100}],Ke="triqUserStats";function fe(){const t=localStorage.getItem(Ke);if(!t)return Ee();try{return JSON.parse(t)}catch(i){return console.error("❌ ユーザーステータスの読み込み失敗:",i),Ee()}}function as(t){localStorage.setItem(Ke,JSON.stringify(t))}function Ee(){return{logic:0,persuasiveness:0,expression:0,diversity:0,depth:0,total:0,history:[],unlockedTitles:[]}}function ls(t,i=""){const s=fe(),r={timestamp:Date.now(),summary:i,total:t.total},n={logic:t.logic,persuasiveness:t.persuasiveness,expression:t.expression,diversity:t.diversity,depth:t.depth,total:t.total,history:[...s.history||[],r]},d=ye(n);return n.unlockedTitles=d.unlocked,as(n),n}function be(t){const i=t.history||[],s=i.length,r=s>0?i.reduce(($,L)=>$+L.total,0)/s:0,n=Math.floor(s*r/5),d=Math.max(0,n),l=Pe(d,i),a=$=>{let L=0,C=100;for(;$>=C;)L++,C+=Math.floor(100*Math.pow(1.2,L));return L},m=$=>{let L=0;for(let C=0;C<=$;C++)L+=Math.floor(100*Math.pow(1.2,C));return L},p=a(l),u=m(p),f=p>0?m(p-1):0,g=Math.max(0,l-f),o=Math.max(1,u-f),h=Math.min(1,g/o),I=s>=2?Pe(Math.floor((s-1)*r/5),i.slice(0,-1)):0,j=a(I);return{level:p,previousLevel:j,exp:l,nextLevelExp:u,progress:g,progressRate:h,avgScore:Math.floor(r),numBattles:s}}function Pe(t,i){const s=i.slice(-3),r=s.reduce((d,l)=>d+l.total,0)/(s.length||1);let n=t;return r<=30&&(n=Math.floor(t*.5)),Math.max(0,n)}function ye(t){const i=be(t),s=new Set(t.unlockedTitles||[]),r=Be.filter(d=>d.condition(t,i));for(const d of r)s.add(d.key);return{current:r.length>0?r[r.length-1]:null,unlocked:Array.from(s)}}function cs(t=fe()){const i=t.history||[];if(i.length<2)return null;const s=i[i.length-2],r=i[i.length-1];return{logic:(t.logic??0)-(s.logic??0),persuasiveness:(t.persuasiveness??0)-(s.persuasiveness??0),expression:(t.expression??0)-(s.expression??0),diversity:(t.diversity??0)-(s.diversity??0),depth:(t.depth??0)-(s.depth??0),total:(r.total??0)-(s.total??0)}}const X=(t,i)=>{const s=t.match(new RegExp(`${i}[:：]\\s*(\\d+)`));return s?parseInt(s[1],10):0},ds=t=>{const i=t.match(/Summary[:：]\s*(.+)/);return i?i[1].trim():"評価が取得できませんでした。"};async function ms({topic:t,debateSummary:i,explanation:s}){const r=os({topic:t,debateSummary:i,explanation:s}),{response:n}=await O(r);console.log(`🧪 Raw evaluation response:
`,n);const d={logic:X(n,"Logic"),persuasiveness:X(n,"Persuasiveness"),expression:X(n,"Expression"),diversity:X(n,"Diversity"),depth:X(n,"Depth"),total:X(n,"Total")},l=ds(n);return ls(d,l)}async function ps({topic:t,debateSummary:i,explanation:s,setIsEvaluating:r,setEvaluationResult:n,setUserEvaluationSummary:d,setShowEvaluationPopup:l}){var f,g;r(!0);const a=await ms({topic:t,debateSummary:i,explanation:s}),m=be(a),p=ye(m.level),u=cs(a);console.log("🧪 スコア変化（changes）:",u),n({newScores:{logic:a.logic,persuasiveness:a.persuasiveness,expression:a.expression,diversity:a.diversity,depth:a.depth,total:a.total},changes:u,levelInfo:m,title:p,summary:((f=a.history.at(-1))==null?void 0:f.summary)||""}),d(((g=a.history.at(-1))==null?void 0:g.summary)||""),r(!1),l(!0)}const us=async({topic:t,turns:i,ai1Persona:s,ai2Persona:r,typeText:n,setFinalDecision:d,setLog:l,logRef:a,setIsDebating:m,setSavedLogs:p,setTopic:u,setCurrentTopic:f,userDebateMode:g=!1,userSide:o="pro",firstTurnSide:h="pro",setIsFinalPhase:I,waitForUserReply:j,setUserEvaluationSummary:$,setEvaluationResult:L,setShowEvaluationPopup:C,setIsEvaluating:T})=>{var se,ie,V;if(console.log("handleStartDebate called. firstTurnSide:",h),!t.trim())return;console.log("userDebateMode:",g,"userSide:",o,"firstTurnSide:",h),m(!0),l([]),a.current=[],d(""),f(t);const _=h==="pro",M=o==="pro",S={"AI-1":{stance:"議題に賛成",prompts:le[s].prompts,prefix:"🧠 AI-1（賛成）：",finalPrefix:"🧠 AI-1（最終意見）：",history:[]},"AI-2":{stance:"議題に反対",prompts:ce[r].prompts,prefix:"⚖️ AI-2（反対）：",finalPrefix:"⚖️ AI-2（最終意見）：",history:[]}},E=(b,w=!1)=>{const N=(w?"🧑 あなた（最終意見）：":"🧑 あなた：")+b;a.current.push(N),l([...a.current])},D=async(b,w,k=!1)=>{let N="";w==="AI-1"||w==="AI-2"?(N=k?S[w].finalPrefix:S[w].prefix,S[w].history.push(b)):w==="AI-3"?N="🧩 AI-3（判定）：":N=w,await n(b,N),a.current.push(`${N}${b}`),l([...a.current])};if(console.log("isProFirst:",h==="pro"),console.log("userGoesFirst:",g?h===o:null),g){const b=M?"AI-2":"AI-1";if(h===o){const k=((se=await(j==null?void 0:j()))==null?void 0:se.trim())||"（ユーザー冒頭意見なし）";E(k);const N=H({role:b,stance:S[b].stance,persona:S[b].prompts.personality,type:"rebuttal",topic:t,limit:"75",opponent:k}),{response:q}=await O(N);await D(q.trim(),b)}else{const k=H({role:b,stance:S[b].stance,persona:S[b].prompts.personality,type:"intro",topic:t,limit:"75"}),{response:N}=await O(k);await D(N.trim(),b);const q=((ie=await(j==null?void 0:j()))==null?void 0:ie.trim())||"（ユーザー冒頭意見なし）";E(q)}}else{const b=_?"AI-1":"AI-2",w=b==="AI-1"?"AI-2":"AI-1",k=H({role:b,stance:S[b].stance,persona:S[b].prompts.personality,type:"intro",topic:t,limit:"75"}),{response:N}=await O(k);await D(N.trim(),b);const q=H({role:w,stance:S[w].stance,persona:S[w].prompts.personality,type:"rebuttal",topic:t,limit:"75",opponent:N.trim()}),{response:G}=await O(q);await D(G.trim(),w)}const x=b=>b.filter(w=>w.startsWith("🧑 あなた：")).map(w=>w.replace("🧑 あなた：","").trim());function y(b){const w=/^[🧠⚖️🧑🧩]\s?/;return b.map(k=>k.replace(w,"").trim())}const A=i-2;for(let b=0;b<A;b++){const w=_?b%2===0?"pro":"con":b%2===0?"con":"pro",k=w==="pro"?"AI-1":"AI-2",N=k==="AI-1"?"AI-2":"AI-1";if(g&&w===o){const q=((V=await(j==null?void 0:j()))==null?void 0:V.trim())||"（ユーザー発言なし）";E(q)}else{const q=g&&w!==o?x(a.current).at(-1)||"":S[N].history.at(-1)||"",G=H({role:k,stance:S[k].stance,persona:S[k].prompts.personality,type:"rebuttal",topic:t,limit:"75",opponent:q,summary:S[k].history.join(" / ")}),{response:re}=await O(G);await D(re.trim(),k)}}I(!0);const P=async(b,w)=>{var k;if(w){const N=((k=await(j==null?void 0:j()))==null?void 0:k.trim())||"（ユーザー最終意見なし）";return E(N,!0),N}else{const N=H({role:b,stance:S[b].stance,persona:S[b].prompts.personality,type:"final",topic:t,limit:"150",summary:S[b].history.join(" / ")}),{response:q}=await O(N),G=q.trim();return await D(G,b,!0),G}},K=_?["pro","con"]:["con","pro"];for(const b of K)await P(b==="pro"?"AI-1":"AI-2",g&&(b==="pro"&&M||b==="con"&&!M));I(!1);const z=y(a.current).join(" / "),{winner:W,explanation:Z}=await ns({topic:t,userDebateMode:g,debateSummary:z,showAndLogAIResponse:D,setFinalDecision:d}),J={id:crypto.randomUUID(),topic:t,tags:[],log:a.current,winner:W,comment:"",timestamp:new Date().toISOString(),ai1PersonaKey:s,ai2PersonaKey:r,ai1PersonaLabel:le[s].label,ai2PersonaLabel:ce[r].label,userDebateMode:g,userSide:o,decidedFirstTurn:h};g&&await ps({topic:t,debateSummary:z,explanation:Z,setIsEvaluating:T,setEvaluationResult:L,setUserEvaluationSummary:$,setShowEvaluationPopup:C});const U=JSON.parse(localStorage.getItem("triqLogs")||"[]");U.push(J),localStorage.setItem("triqLogs",JSON.stringify(U)),p(U),u(""),m(!1)};function xs({sidebarOpen:t,toggleSidebar:i}){return e.jsx("button",{onClick:s=>{s.stopPropagation(),i()},className:"fixed bottom-6 right-6 z-[100] w-16 h-16 rounded-full bg-indigo-600 text-white shadow-lg flex items-center justify-center text-2xl hover:bg-indigo-700 transition-all duration-300","aria-label":t?"ログを閉じる":"ログを表示",children:e.jsx(Re,{mode:"wait",initial:!1,children:t?e.jsx(Q.div,{initial:{rotate:-180,opacity:0},animate:{rotate:0,opacity:1},exit:{rotate:180,opacity:0},transition:{duration:.4},children:e.jsx(Me,{className:"w-7 h-7"})},"close"):e.jsx(Q.div,{initial:{rotate:180,opacity:0},animate:{rotate:0,opacity:1},exit:{rotate:-180,opacity:0},transition:{duration:.4},children:e.jsx(wt,{className:"w-7 h-7"})},"open")})})}function gs({stats:t}){const i=[{stat:"論理力",key:"logic",value:t.logic},{stat:"説得力",key:"persuasiveness",value:t.persuasiveness},{stat:"表現力",key:"expression",value:t.expression},{stat:"多様性",key:"diversity",value:t.diversity},{stat:"洞察力",key:"depth",value:t.depth}];return e.jsxs("div",{className:"bg-gray-800 p-4 rounded shadow flex flex-col md:flex-row items-center md:items-start gap-4 h-auto",children:[e.jsxs("div",{className:"w-full md:w-2/3 h-[220px] sm:h-64 md:h-72",children:[e.jsx("h3",{className:"text-sm mb-2 text-indigo-300",children:"5ステータス分布"}),e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(qe,{data:i,children:[e.jsx(_e,{stroke:"#444"}),e.jsx(Qe,{dataKey:"stat",stroke:"#aaa"}),e.jsx(Oe,{angle:45,domain:[0,100],stroke:"#777"}),e.jsx(We,{name:"現在の値",dataKey:"value",stroke:"#60a5fa",fill:"#60a5fa",fillOpacity:.6})]})})]}),e.jsxs("div",{className:"w-full md:w-1/3 space-y-2 text-sm text-gray-200",children:[e.jsx("h4",{className:"text-indigo-300 text-sm",children:"現在の数値"}),e.jsx("ul",{className:"space-y-1",children:i.map(s=>e.jsxs("li",{className:"flex justify-between border-b border-gray-700 pb-1",children:[e.jsx("span",{children:s.stat}),e.jsx("span",{className:"font-bold text-indigo-400",children:s.value})]},s.key))})]})]})}function hs({history:t}){const i=t.map(s=>({date:new Date(s.timestamp).toLocaleDateString(),total:s.total}));return e.jsxs("div",{className:"h-48 bg-gray-800 p-4 rounded shadow",children:[e.jsx("h3",{className:"text-sm mb-2 text-indigo-300",children:"総合スコアの推移"}),e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Nt,{data:i,children:[e.jsx(It,{strokeDasharray:"3 3",stroke:"#444"}),e.jsx(St,{dataKey:"date",stroke:"#aaa"}),e.jsx(At,{domain:[0,"auto"],stroke:"#aaa"}),e.jsx(kt,{}),e.jsx(Tt,{type:"monotone",dataKey:"total",stroke:"#60a5fa",strokeWidth:2,dot:{r:3}})]})})]})}function fs({history:t}){return e.jsxs("div",{className:"mt-6 bg-gray-800 p-4 rounded shadow max-h-60 overflow-y-auto",children:[e.jsx("h3",{className:"text-sm mb-2 text-indigo-300",children:"AIの総合コメント履歴"}),e.jsx("ul",{className:"space-y-2 text-sm text-gray-200",children:t.slice().reverse().map((i,s)=>e.jsxs("li",{className:"border-b border-gray-600 pb-2",children:[e.jsx("div",{className:"text-xs text-gray-400",children:new Date(i.timestamp).toLocaleString()}),e.jsxs("div",{className:"mt-1 italic",children:["“",i.summary||"（コメントなし）","”"]})]},s))})]})}function bs(){const[t,i]=c.useState(null),[s,r]=c.useState(null);if(c.useEffect(()=>{i(fe())},[]),!t)return null;const n=t.history||[],{level:d,exp:l,nextLevelExp:a,progressRate:m,avgScore:p,numBattles:u}=be(t),{current:f,unlocked:g}=ye(t);return e.jsxs("div",{className:"p-4 bg-gray-900 text-white rounded-xl shadow-md max-w-2xl mx-auto space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-indigo-300",children:"🧠 討論スコア"}),e.jsxs("div",{className:"text-center my-4",children:[e.jsx("div",{className:"text-indigo-400 text-sm",children:"現在の称号"}),e.jsxs("div",{className:"text-2xl font-bold",children:[f==null?void 0:f.emoji," ",f==null?void 0:f.title]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["レベル: ",d,"（Exp: ",l," / ",a,"）"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["平均スコア: ",p,"・討論数: ",u]}),e.jsx("div",{className:"w-full bg-gray-700 rounded mt-2 h-3",children:e.jsx("div",{className:"bg-indigo-500 h-3 rounded transition-all",style:{width:`${m*100}%`}})})]}),e.jsxs("div",{className:"text-sm text-indigo-300 mt-4",children:[e.jsx("div",{className:"mb-2",children:"獲得した称号："}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:Be.filter(o=>g.includes(o.key)).map(o=>e.jsx("div",{className:"flex flex-col items-center text-center",children:e.jsx("button",{onClick:()=>r(o),className:"text-xl hover:scale-110 transition-transform",title:o.title,children:o.emoji})},o.key))}),s&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-800 rounded shadow text-left max-w-sm mx-auto",children:[e.jsxs("div",{className:"font-bold text-indigo-300 text-base mb-1",children:[s.emoji," ",s.title]}),e.jsx("div",{className:"text-gray-300 text-sm mb-2",children:s.description}),e.jsxs("div",{className:"text-xs text-gray-500 italic",children:["獲得条件：",s.conditionDescription||"不明"]})]})]}),e.jsx(gs,{stats:t}),e.jsx(hs,{history:n}),e.jsx(fs,{history:n})]})}function ys({result:t,onClose:i}){if(!t)return null;const{newScores:s,changes:r,title:n,summary:d,level:l,previousLevel:a,exp:m,nextLevelExp:p,progressRate:u}=t,f=a!==void 0&&l>a,g=[{subject:"Logic",value:s.logic},{subject:"Persuasion",value:s.persuasiveness},{subject:"Expression",value:s.expression},{subject:"Diversity",value:s.diversity},{subject:"Depth",value:s.depth}];return console.log("📊 newScores:",s),e.jsx(Re,{children:e.jsx(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4",children:e.jsxs(Q.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{type:"spring",duration:.5},className:"bg-white rounded-2xl shadow-2xl p-4 sm:p-6 w-full max-w-sm sm:max-w-md md:max-w-lg text-center relative",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-1",children:"🧠 今回の討論評価"}),f&&e.jsx(Q.div,{className:"text-pink-600 font-bold text-lg mb-1",initial:{scale:0,rotate:-10,opacity:0},animate:{scale:1.2,rotate:0,opacity:1},transition:{type:"spring",stiffness:300,damping:12},children:"🎉 レベルアップ！"}),e.jsxs(Q.p,{className:"text-lg font-semibold text-indigo-600 mb-2",initial:{scale:0},animate:{scale:1.1},transition:{type:"spring",stiffness:300},children:["🌟 ",n.current?n.current.label:"称号なし","（Lv.",l,"）"]}),e.jsx("div",{className:"w-full h-[250px] mb-4",children:e.jsx(he,{children:e.jsxs(qe,{cx:"50%",cy:"50%",outerRadius:"80%",data:g,children:[e.jsx(_e,{}),e.jsx(Qe,{dataKey:"subject"}),e.jsx(Oe,{domain:[0,100]}),e.jsx(We,{name:"スコア",dataKey:"value",stroke:"#4f46e5",fill:"#6366f1",fillOpacity:.5})]})})}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["経験値: ",m," / ",p]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden mt-1",children:e.jsx(Q.div,{className:"bg-green-500 h-full",initial:{width:0},animate:{width:`${u*100}%`},transition:{duration:1}})})]}),e.jsxs("div",{className:"text-left text-sm text-gray-700 mb-4",children:[e.jsx("p",{className:"font-semibold mb-1",children:"📈 今回の変化:"}),e.jsxs("ul",{className:"list-disc list-inside",children:[r&&Object.entries(r).map(([o,h])=>o!=="total"?e.jsxs("li",{children:[o[0].toUpperCase()+o.slice(1),": ",h>=0?"+":"",h]},o):null),e.jsxs("li",{children:["総合得点: ",r.total>=0?"+":"",r.total]})]})]}),e.jsxs("div",{className:"text-sm text-gray-800 text-left whitespace-pre-wrap",children:[e.jsx("p",{className:"font-semibold mb-1",children:"評論AIの総評："}),e.jsx("p",{children:d})]}),e.jsx(Q.button,{whileTap:{scale:.95},onClick:i,className:"mt-6 w-full bg-indigo-600 text-white py-2 rounded-xl shadow-md hover:bg-indigo-700 transition",children:"確認"})]})})})}function vs(){const[t,i]=c.useState(""),[s,r]=c.useState(4),[n,d]=c.useState([]),[l,a]=c.useState(""),[m,p]=c.useState([]),[u,f]=c.useState(!1),[g,o]=c.useState(!1),[h,I]=c.useState(""),[j,$]=c.useState("all"),[L,C]=c.useState(null),[T,_]=c.useState(""),[M,S]=c.useState(!1),[E,D]=c.useState(""),[x,y]=c.useState(!1),[A,P]=c.useState("AIpropose"),[K,z]=c.useState("AIoppose"),[W,Z]=c.useState(De()),[J,U]=c.useState(!1),[se,ie]=c.useState(""),[V,b]=c.useState(!1),[w,k]=c.useState(!1),[N,q]=c.useState("pro"),[G,re]=c.useState(!1),[Y,ve]=c.useState(null),[Je,je]=c.useState(0),[ne,we]=c.useState(!1),Ue=5*1e3,Ve=c.useRef([]),oe=c.useRef(null),Ne=Lt(),Ye=c.useRef(null),He=c.useRef(null),de=Ge(),[Ie,Se]=c.useState(!1),[Ae,Xe]=c.useState(null),[As,Ze]=c.useState(""),[ke,et]=c.useState(!1),[tt,st]=c.useState(!1),it=()=>new Promise(v=>{b(!0),oe.current=R=>{b(!1),v(R)}});c.useEffect(()=>{const v=JSON.parse(localStorage.getItem("triqLogs")||"[]");p(v)},[]),c.useEffect(()=>{let v;return ne&&(v=setTimeout(()=>{we(!1),je(0)},Ue)),()=>clearTimeout(v)},[ne]),c.useEffect(()=>{const v=setInterval(async()=>{await ts(),Z(De())},12e4);return()=>clearInterval(v)},[]),c.useEffect(()=>{const R=new URLSearchParams(Ne.search).get("redirect");R&&de(`/${R}`,{replace:!0})},[Ne.search,de]);const rt=async()=>{if(!(ne||J)){if(Je>=3){we(!0);return}je(v=>v+1),U(!0);try{const v=m.map(ee=>ee.topic),R=v.length>5?v.slice(-20):v,F=await rs(R);i(F)}finally{U(!1)}}},nt=()=>{u&&f(!1)},ot=v=>{if(!window.confirm("このログを削除しますか？"))return;const R=m.filter(F=>F.id!==v);localStorage.setItem("triqLogs",JSON.stringify(R)),p(R)},at=()=>f(!u),lt=(v,R="",F=20)=>new Promise(ee=>{let Te="",me=0;const ut=setInterval(()=>{Te+=v[me],C(R+Te),me++,me>=v.length&&(clearInterval(ut),C(null),ee())},F)}),ct=v=>{var R;(R=oe.current)==null||R.call(oe,v)},dt=v=>{ve(v),re(!1)},mt=()=>{S(!0),re(!0),ve(null)},pt=v=>{us({topic:t,turns:s,ai1Persona:A,ai2Persona:K,typeText:lt,setFinalDecision:a,setLog:d,logRef:Ve,setIsDebating:S,setSavedLogs:p,setTopic:i,setCurrentTopic:_,setIsFinalPhase:et,userDebateMode:w,userSide:N,firstTurnSide:v,waitForUserReply:it,setIsEvaluating:st,setUserEvaluationSummary:Ze,setEvaluationResult:Xe,setShowEvaluationPopup:Se})};return c.useEffect(()=>{Y&&pt(Y)},[Y]),e.jsxs("main",{className:"min-h-screen bg-gradient-to-br from-gray-950 via-slate-900 to-gray-800 text-white p-6 font-sans relative",onClick:nt,children:[e.jsx("div",{className:`fixed inset-0 bg-black z-40 transition-opacity duration-300 ${u?"opacity-40 pointer-events-auto":"opacity-0 pointer-events-none"}`,onClick:()=>f(!1)}),e.jsx("div",{className:`fixed top-0 right-0 h-full w-[80vw] max-w-xs bg-gray-950 text-white shadow-lg rounded-l-xl z-50 transition-transform duration-300 ease-in-out transform ${u?"translate-x-0":"translate-x-full"}`,onClick:v=>v.stopPropagation(),children:e.jsx(Kt,{sidebarOpen:u,closeSidebar:()=>f(!1),savedLogs:m,filteredLogs:m.filter(v=>{const R=v.topic.includes(h),F=j==="all"?!0:j==="pro"?v.winner.startsWith("AI-1"):j==="con"?v.winner.startsWith("AI-2"):v.winner.startsWith("判定不能"),ee=E===""||(v.tags||[]).includes(E);return R&&F&&ee}),searchKeyword:h,setSearchKeyword:I,filter:j,setFilter:$,deleteLog:ot,navigate:de,selectedTag:E,setSelectedTag:D})}),e.jsxs("div",{className:"max-w-[min(600px,90vw)] mx-auto pt-6",onClick:v=>v.stopPropagation(),children:[e.jsx("div",{className:`transition-all duration-300 ${M?"pointer-events-none opacity-50 blur-[1px]":"pointer-events-auto opacity-100"}`,children:e.jsx(Ht,{topic:t,setTopic:i,turns:s,setTurns:r,showMoreTurns:x,setShowMoreTurns:y,isGeneratingTopic:J,cooldown:ne,handleGenerateTopic:rt,userDebateMode:w,setUserDebateMode:k,userSide:N,setUserSide:q,ai1Persona:A,setAi1Persona:P,ai2Persona:K,setAi2Persona:z,handleStartDebateWithTurnDecider:mt,isDebating:M,ai1ScrollRef:Ye,ai2ScrollRef:He})}),G&&e.jsx(Ut,{onDecide:dt,userDebateMode:w,userSide:N}),Y&&e.jsxs("div",{className:"mt-4 text-center text-indigo-300 font-semibold",children:["先攻：",w?Y==="pro"?N==="pro"?"賛成（あなた）":"賛成（AI）":N==="con"?"反対（あなた）":"反対（AI）":Y==="pro"?"賛成（AI-1）":"反対（AI-2）"]}),e.jsxs("div",{className:"fixed bottom-2 left-2 text-xs text-gray-400 select-none pointer-events-none",children:["使用モデル: Gemini-",W,"-flash"]}),T&&e.jsxs("div",{className:"text-center text-indigo-300 mt-4 select-text text-lg sm:text-xl font-semibold",children:["現在の議題：","「"+T+"」"]}),L&&e.jsx("div",{className:"text-center mt-3 text-indigo-200 text-base sm:text-lg font-mono animate-pulse whitespace-pre-wrap",children:L}),l&&e.jsx("div",{className:"mt-3 max-w-md mx-auto rounded-lg bg-gradient-to-r from-indigo-700 via-purple-700 to-indigo-700 text-white p-3 shadow-lg text-center font-semibold text-lg sm:text-xl",children:l}),e.jsx(Jt,{log:n,finalDecision:l,topic:T,isUserInputVisible:V,userSide:N,isDebating:M}),V&&e.jsx(Xt,{isVisible:V,isFinalPhase:ke,userInput:se,setUserInput:ie,onSubmit:ct,maxLength:ke?150:75})]}),!M&&!g&&e.jsx(xs,{sidebarOpen:u,toggleSidebar:at}),!u&&e.jsx("button",{onClick:v=>{v.stopPropagation(),o(R=>!R)},className:`fixed top-4 right-4 z-50 p-2 rounded-full shadow transition
    ${g?"bg-gray-800 text-gray-300 hover:text-white":"bg-indigo-600 text-white hover:bg-indigo-700"}`,title:g?"ステータスを閉じる":"ステータスを見る",children:g?e.jsx(Me,{className:"w-10 h-10"}):e.jsx(Ct,{className:"w-10 h-10"})}),tt&&!Ie&&e.jsx("div",{className:"text-center text-gray-600 mt-4 animate-pulse",children:"🧠 評価中です...しばらくお待ちください"}),Ie&&Ae&&e.jsx(ys,{result:Ae,onClose:()=>Se(!1)}),g&&e.jsx("div",{className:"fixed inset-0 z-10 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center animate-fade-in",onClick:()=>o(!1),children:e.jsx("div",{className:"bg-gray-900 rounded-xl max-w-3xl w-[95%] max-h-[95vh] overflow-y-auto p-6 animate-pop",onClick:v=>v.stopPropagation(),children:e.jsx(bs,{})})})]})}function js({logData:t,title:i}){const[s,r]=c.useState(!1),[n,d]=c.useState(!1),[l,a]=c.useState(""),[m,p]=c.useState(null),u=c.useRef(null);c.useEffect(()=>{function o(h){u.current&&!u.current.contains(h.target)&&r(!1)}return s?document.addEventListener("mousedown",o):document.removeEventListener("mousedown",o),()=>{document.removeEventListener("mousedown",o)}},[s]);const f=async()=>{try{await navigator.clipboard.writeText(l),d(!0),setTimeout(()=>d(!1),2e3)}catch(o){console.error("URLコピー失敗:",o)}},g=async()=>{if(t)try{const o=await zt(t,t.firestoreId),h=`${window.location.origin}/TriQ/?redirect=log/${o}`;a(h),r(!0);const I={...t,firestoreId:o},$=JSON.parse(localStorage.getItem("triqLogs")||"[]").map(L=>L.id===t.id?I:L);localStorage.setItem("triqLogs",JSON.stringify($))}catch(o){console.error("Firestore共有失敗:",o),alert("共有に失敗しました。もう一度お試しください。")}};return e.jsxs("div",{ref:u,className:"relative inline-block text-left z-50",children:[e.jsx("button",{onClick:g,className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 rounded text-white font-semibold",children:"共有"}),s&&l&&e.jsxs("div",{className:"absolute bottom-full right-0 mb-2 w-56 bg-white p-4 rounded shadow-lg flex flex-col gap-3 z-50",children:[e.jsx(Dt,{url:l,quote:i,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($t,{size:32,round:!0}),e.jsx("span",{className:"text-sm text-gray-800 font-medium",children:"Facebookで共有"})]})}),e.jsx(Et,{url:l,title:i,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pt,{size:32,round:!0}),e.jsx("span",{className:"text-sm text-gray-800 font-medium",children:"Twitterで共有"})]})}),e.jsx(Rt,{url:l,title:i,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Mt,{size:32,round:!0}),e.jsx("span",{className:"text-sm text-gray-800 font-medium",children:"LINEで共有"})]})}),e.jsx("button",{onClick:f,className:"flex items-center gap-2 text-indigo-600 hover:text-indigo-800 text-sm font-medium",children:"📋 URLをコピー"}),n&&e.jsx("div",{className:"text-green-600 text-xs mt-1",children:"✅ コピーしました！"})]})]})}function ws(t){if(typeof t!="string")return t;const i=/(#\S+?)(?=\s|$|[.,!?"'“”‘’])/g,s=[];let r=0,n;for(;(n=i.exec(t))!==null;)n.index>r&&s.push(t.substring(r,n.index)),s.push(e.jsx("span",{className:"inline-block bg-indigo-600 text-white px-2 py-0.5 rounded-full text-xs font-bold mr-1 select-none",children:n[1]},n.index)),r=n.index+n[1].length;return r<t.length&&s.push(t.substring(r)),s}function ue(t){return t.startsWith("🧠 AI-1（最終意見）：")||t.startsWith("⚖️ AI-2（最終意見）：")||t.startsWith("🧑 あなた（最終意見）：")?"final":t.startsWith("🧩")?"judge":"exchange"}function Ns(t){return t.startsWith("🧠")?"ai1":t.startsWith("⚖️")?"ai2":t.startsWith("🧑")?"user":t.startsWith("🧩")?"judge":"other"}function xe({line:t,idx:i,userSide:s}){const r=Ns(t),n=t.replace(/^🧠 AI-1（最終意見）：|^🧠 AI-1（賛成）：|^🧠 .*?：|^⚖️ AI-2（最終意見）：|^⚖️ AI-2（反対）：|^⚖️ .*?：|^🧩 .*?：|^🧑 あなた（最終意見）：|^🧑 あなた：/,""),d="max-w-[90%] p-6 rounded-2xl shadow-xl whitespace-pre-wrap font-sans text-base sm:text-lg leading-relaxed mb-4";let l="flex ",a="",m="";return r==="ai1"?(a="bg-gradient-to-br from-blue-200 to-white border-l-4 border-blue-500 text-gray-900 text-left",l+=" justify-start",m=s?"AI（賛成）":"🧠 AI-1（賛成）"):r==="ai2"?(a="bg-gradient-to-bl from-red-200 to-white border-r-4 border-red-500 text-gray-900 text-left",l+=" justify-end",m=s?"AI（反対）":"⚖️ AI-2（反対）"):r==="user"?s==="pro"?(a="bg-gradient-to-br from-yellow-200 to-white border-l-4 border-yellow-500 text-gray-900 text-left",l+=" justify-start",m="🧑 あなた（賛成）"):s==="con"?(a="bg-gradient-to-bl from-yellow-200 to-white border-r-4 border-yellow-500 text-gray-900 text-left",l+=" justify-end",m="🧑 あなた（反対）"):(a="bg-gradient-to-br from-yellow-200 to-white border-l-4 border-yellow-500 text-gray-900 text-left",l+=" justify-start",m="🧑 あなた"):r==="judge"?(a="bg-gradient-to-b from-green-100 to-white border-t-4 border-green-500 text-gray-900 text-center",l+=" justify-center",m="🧩 AI-3（判定）"):(a="bg-gray-200 text-gray-900 border border-gray-300",l+=" justify-start",m="AI"),e.jsx("div",{className:l,children:e.jsxs("div",{className:`${d} ${a}`,children:[e.jsx("div",{className:"font-semibold opacity-80 mb-1 select-none",children:m}),e.jsx("div",{children:ws(n)})]})})}function Is(){var E,D;const{id:t}=qt(),i=Ge(),[s,r]=c.useState(null),[n,d]=c.useState(!1),[l,a]=c.useState(""),[m,p]=c.useState(""),[u,f]=c.useState(""),[g,o]=c.useState(null);c.useEffect(()=>{(async()=>{if(!t)return;if(t.length<=20)try{const P=await Ft(t);if(P){d(!0),r(P),a(P.comment||""),o(t);return}}catch(P){console.error("Firestoreログ取得失敗:",P)}const A=JSON.parse(localStorage.getItem("triqLogs")||"[]").find(P=>P.id===t);d(!1),r(A),a((A==null?void 0:A.comment)||"")})()},[t]),c.useEffect(()=>{s!=null&&s.winner&&f(`🏁 結論：${s.winner}`)},[s]);const h=x=>{const A=JSON.parse(localStorage.getItem("triqLogs")||"[]").map(P=>P.id===x.id?x:P);localStorage.setItem("triqLogs",JSON.stringify(A)),r(x)},I=x=>{const y=x.target.value.replace(/#/g,"");a(y),!(!s||n)&&h({...s,comment:y})},j=x=>{var A;if(!s||n)return;const y=x.trim().replace(/^#/,"");!y||(A=s.tags)!=null&&A.includes(y)||h({...s,tags:[...s.tags||[],y]})},$=x=>{!s||!s.tags||n||h({...s,tags:s.tags.filter(y=>y!==x)})},L=x=>{const y=x.target.value;if(y.endsWith(" ")||y.endsWith("　")){const A=y.trim();A.startsWith("#")&&A.length>1&&j(A),p("")}else p(y)},C=()=>i("/"),T=c.useMemo(()=>{var x;return((x=s==null?void 0:s.log)==null?void 0:x.filter(y=>ue(y)==="exchange"))||[]},[s]),_=c.useMemo(()=>{var x;return((x=s==null?void 0:s.log)==null?void 0:x.filter(y=>ue(y)==="final"))||[]},[s]),M=c.useMemo(()=>{var x;return((x=s==null?void 0:s.log)==null?void 0:x.filter(y=>ue(y)==="judge"))||[]},[s]);if(!s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center text-white p-6",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-red-400 text-xl mb-4",children:"ログが見つかりません。"}),e.jsx("button",{onClick:C,className:"px-6 py-3 bg-indigo-600 hover:bg-indigo-700 rounded text-white font-semibold",children:"ホームへ戻る"})]})});function S(x,y){const A=x==="pro",P=y.userDebateMode&&y.userSide===x,K=A?y.ai1PersonaKey:y.ai2PersonaKey,z=A?y.ai1PersonaLabel:y.ai2PersonaLabel,W=(A?le:ce)[K],Z=y.userDebateMode?`${A?"賛成":"反対"}（${P?"あなた":"AI"}）`:`${A?"賛成":"反対"}（${A?"AI-1":"AI-2"}）`,J=P?"bg-yellow-400 text-gray-900":A?"bg-blue-600 text-white":"bg-red-600 text-white";return e.jsxs("div",{className:`p-4 rounded-xl min-w-[160px] max-w-[240px] text-center shadow-lg ${J}`,children:[e.jsx("div",{className:"font-bold text-lg mb-2",children:Z}),P?e.jsx("div",{className:"w-24 h-24 mx-auto rounded-full bg-yellow-300 text-gray-900 flex items-center justify-center text-lg font-bold shadow-md mb-2",children:"YOU"}):W!=null&&W.image?e.jsx("img",{src:W.image,alt:z,className:"w-24 h-24 mx-auto rounded-full mb-2 object-cover border-2 border-white shadow-md"}):e.jsx("div",{className:"w-24 h-24 mx-auto rounded-full bg-gray-700 flex items-center justify-center text-white text-xl font-bold mb-2",children:"AI"}),!P&&e.jsx("div",{className:"text-sm font-medium mt-1",children:z||"不明"})]},x)}return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-blue-950 to-gray-900 text-white p-6 pb-24 font-sans relative",children:[e.jsxs("div",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 flex gap-4 z-50",children:[e.jsx("button",{onClick:C,className:"px-6 py-3 bg-indigo-600 hover:bg-indigo-700 rounded text-white font-semibold",children:"ホーム"}),!n&&e.jsx(js,{logData:s,firestoreId:g,onSaved:x=>o(x),title:`TriQ議論：「${s.topic}」`})]}),e.jsxs("div",{className:"max-w-3xl mx-auto space-y-8",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"text-3xl font-bold text-indigo-300 mb-3",children:"議題"}),e.jsx("div",{className:"bg-gray-800 p-6 rounded-lg text-lg border border-gray-700 whitespace-pre-wrap",children:s.topic})]}),e.jsx("section",{className:"mb-6",children:e.jsxs("div",{className:"relative flex justify-center items-center gap-8 flex-wrap max-w-3xl mx-auto",children:[S("pro",s),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-gray-300 font-extrabold text-6xl select-none pointer-events-none",style:{transform:"translate(-50%, -50%) rotate(-15deg)",textShadow:"1px 1px 6px rgba(0, 0, 0, 0.7)",userSelect:"none",zIndex:10,whiteSpace:"nowrap"},children:"VS"}),S("con",s)]})}),u&&e.jsx("div",{className:"mt-3 max-w-md mx-auto rounded-lg bg-gradient-to-r from-indigo-700 via-purple-700 to-indigo-700 text-white p-3 shadow-lg text-center font-semibold text-lg sm:text-xl",children:u}),s.decidedFirstTurn&&e.jsxs("div",{className:"mt-3 text-center text-indigo-300 font-semibold text-lg",children:["先攻：",s.userDebateMode?s.decidedFirstTurn==="pro"?s.userSide==="pro"?"賛成（あなた）":"賛成（AI）":s.userSide==="con"?"反対（あなた）":"反対（AI）":s.decidedFirstTurn==="pro"?"賛成（AI-1）":"反対（AI-2）"]}),((E=s.tags)==null?void 0:E.length)>0&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-indigo-300 mb-2",children:"タグ"}),((D=s.tags)==null?void 0:D.length)>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:s.tags.map((x,y)=>e.jsxs("span",{className:"inline-flex items-center bg-indigo-700 text-white px-3 py-1 rounded-full text-sm font-medium select-none",children:["#",x,!n&&e.jsx("button",{onClick:()=>$(x),className:"ml-2 text-indigo-200 hover:text-white font-bold",children:"×"})]},y))}):e.jsx("div",{className:"text-gray-500 text-sm",children:"タグなし"})]}),!n&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-indigo-300 mb-2",children:"タグ追加"}),e.jsx("input",{type:"text",value:m,onChange:L,placeholder:"#タグを入力してSpace",className:"w-full p-2 rounded bg-gray-800 border border-indigo-600 text-white placeholder-gray-400"})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-indigo-200 mb-4",children:"コメント"}),n?e.jsx("div",{className:"p-4 bg-gray-900 text-white border border-gray-800 rounded-lg text-base whitespace-pre-wrap",children:l.trim()?l:e.jsx("span",{className:"text-gray-500",children:"コメントなし"})}):e.jsx("textarea",{rows:4,value:l,onChange:I,placeholder:"ここにコメントを入力(自動保存)",className:"w-full p-4 rounded-lg bg-gray-800 border border-gray-700 text-white"})]}),T.length>0&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-indigo-200 mb-4",children:"🌀 応酬フェーズ"}),e.jsx("div",{className:"flex flex-col",children:T.map((x,y)=>e.jsx(xe,{line:x,userSide:s.userSide},y))})]}),_.length>0&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-purple-300 mb-4",children:"🧭 最終意見フェーズ"}),e.jsx("div",{className:"flex flex-col",children:_.map((x,y)=>e.jsx(xe,{line:x,userSide:s.userSide},y))})]}),M.length>0&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-green-400 mb-4",children:"🏁 判定フェーズ"}),e.jsx("div",{className:"flex flex-col",children:M.map((x,y)=>e.jsx(xe,{line:x,userSide:s.userSide},y))})]}),e.jsxs("div",{className:"text-sm text-gray-400 text-right",children:["保存日時：",new Date(s.timestamp).toLocaleString()]})]})]})}function Ss(){return e.jsx(_t,{basename:"/TriQ",children:e.jsxs("div",{className:"min-h-screen bg-gradient-to-r from-gray-900 via-blue-900 to-gray-900 text-white font-sans",children:[e.jsxs("header",{className:"py-6 text-center bg-gradient-to-r from-indigo-700 via-purple-800 to-indigo-900 shadow-lg",children:[e.jsxs("div",{className:"flex justify-center items-center gap-3",children:[e.jsx("img",{src:"/TriQ/logo192.png",alt:"TriQ logo",className:"w-10 h-10 sm:w-12 sm:h-12 rounded-md shadow-md"}),e.jsx("h1",{className:"text-4xl sm:text-5xl font-extrabold text-white drop-shadow-lg tracking-wide select-none",children:"TriQ"})]}),e.jsx("p",{className:"mt-1 text-sm sm:text-base text-indigo-200 font-light select-none",children:"AIたちによる未来型討論アプリ"})]}),e.jsxs(Qt,{children:[e.jsx(Le,{path:"/",element:e.jsx(vs,{})}),e.jsx(Le,{path:"/log/:id",element:e.jsx(Is,{})})]})]})})}Ot.createRoot(document.getElementById("root")).render(e.jsx(c.StrictMode,{children:e.jsx(Ss,{})}));
